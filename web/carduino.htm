<!doctype html>

<html>
  <head>
    <title>Auto-adjust</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <style>
      body {
        text-align: center;
      }

      #p1g1, #p1g2, #p1g3, #p2g1, #p2g2, #p2g3 {
        width:200px; height:160px;
        display: inline-block;
        margin: 1em;
      }

      p {
        display: block;
        width: 450px;
        margin: 2em auto;
        text-align: left;
      }
    </style>


  </head>
  <body>
	  <h2>Player 1:</h2>
    <div id="p1g1"></div>
    <div id="p1g2"></div>
    <div id="p1g3"></div>
	<h2>Player 2:</h2>
	<div id="p2g1"></div>
	<div id="p2g2"></div>
	<div id="p2g3"></div>

    <script src="js/raphael-2.1.4.min.js"></script>
    <script src="js/justgage.js"></script>
    <script>
      var p1g1, p1g2, p1g3;
      var p2g1, p2g2, p2g3;
      var ws;
      var identity = {
          "type": "identity",
          "data": {
              "type": "web",
              "id": "2637"
          },
          "version": 1.0
      };

      window.onload = function(){
	var ws = new WebSocket('ws://localhost:8080/');

        var p1g1 = new JustGage({
          id: "p1g1",
          value: 0,
          min: 0,
          max: 100,
          title: "Speed",
          label: "km/h"
        });

        var p1g2 = new JustGage({
          id: "p1g2",
          value: 0,
          min: 0,
          max: 100,
          title: "RPM",
          label: "x100/s"
        });

        var p1g3 = new JustGage({
          id: "p1g3",
          value: 0,
          min: 0,
          max: 100,
          title: "G-force",
          label: "m/s^2"
        });

	var p2g1 = new JustGage({
	  id: "p2g1",
	  value: 0,
	  min: 0,
	  max: 100,
	  title: "Speed",
	  label: "km/h"
	});

	var p2g2 = new JustGage({
	  id: "p2g2",
	  value: getRandomInt(0, 100),
	  min: 0,
	  max: 100,
	  title: "RPM",
	  label: "x100/s"
	});

	var p2g3 = new JustGage({
	  id: "p2g3",
	  value: getRandomInt(0, 100),
	  min: 0,
	  max: 100,
	  title: "G-force",
	  label: "m/s^2"
	});

        ws.onopen = function(event) {
                ws.send(JSON.stringify(identity));
        }
	ws.onmessage = function(event) {
                var msg = JSON.parse(event.data);

                if ( msg.type == 'telemetrics' ) {
                        p1g1.refresh(msg.data.speed);
                        p1g2.refresh(msg.data.rpm);
                        p1g3.refresh(msg.data.gforce);
                }

	    console.log('Message received: ' + msg);
	};

        setInterval(function() {
          //p1g2.refresh(getRandomInt(50, 100));
          //p1g3.refresh(getRandomInt(0, 50));
	  p2g2.refresh(getRandomInt(50, 100));
          p2g3.refresh(getRandomInt(0, 50));
  }, 100);
      };
    </script>
  </body>
</html>
